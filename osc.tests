#! /bin/sh
set -e

case $# in
0)  echo "Usage: $0 dir" >&2
    exit 1
    ;;
*)  ;;
esac

cd $1
shift
# I believe that some previous version needed this, but now it causes
# PNG exports to SIGSEGV.
#cp -v "/mingw64/bin/opengl32.dll" .
cp -v winconsole/openscad.com .
cd tests
ctest -j2 -E 'opencsgtest_issue1165|opencsgtest_issue1215|throwntogethertest_issue1089|throwntogethertest_issue1215|openscad-nonascii|import_3mf|3mfpngtest|3mfexport' "$@"
# |pdfexporttest_centered
